

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>部署 &mdash; Explore Flask 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Explore Flask 1.0 documentation" href="index.html"/>
        <link rel="next" title="结尾" href="conclusion.html"/>
        <link rel="prev" title="处理用户的模式" href="users.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Explore Flask</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">前言</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preface.html#id2">假设</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#id10">动态文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#id11">本书使用的约定</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#id15">彩蛋</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#id16">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">编码约定</a><ul>
<li class="toctree-l2"><a class="reference internal" href="conventions.html#pep">让我们来个 PEP 动员！</a></li>
<li class="toctree-l2"><a class="reference internal" href="conventions.html#id3">相对导入</a></li>
<li class="toctree-l2"><a class="reference internal" href="conventions.html#id4">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">环境</a><ul>
<li class="toctree-l2"><a class="reference internal" href="environment.html#virtualenv">使用 virtualenv 管理你的环境</a></li>
<li class="toctree-l2"><a class="reference internal" href="environment.html#id6">版本控制</a></li>
<li class="toctree-l2"><a class="reference internal" href="environment.html#id8">调试</a></li>
<li class="toctree-l2"><a class="reference internal" href="environment.html#id12">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="organizing.html">组织你的项目</a><ul>
<li class="toctree-l2"><a class="reference internal" href="organizing.html#id2">定义</a></li>
<li class="toctree-l2"><a class="reference internal" href="organizing.html#id4">组织模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="organizing.html#id10">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">配置</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#id2">简单的例子</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#id3">实例文件夹</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#id8">基于环境变量配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#id9">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views.html">视图和路由的高级模式</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views.html#id2">视图装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html#url-converters">URL 转换器(converters)</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html#id9">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="blueprints.html">蓝图</a><ul>
<li class="toctree-l2"><a class="reference internal" href="blueprints.html#id2">什么是蓝图？</a></li>
<li class="toctree-l2"><a class="reference internal" href="blueprints.html#id3">为什么要使用蓝图？</a></li>
<li class="toctree-l2"><a class="reference internal" href="blueprints.html#id5">你把它们放哪里？</a></li>
<li class="toctree-l2"><a class="reference internal" href="blueprints.html#id9">你如何使用它们？</a></li>
<li class="toctree-l2"><a class="reference internal" href="blueprints.html#id12">使用蓝图重构小的应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="blueprints.html#id18">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">模板</a><ul>
<li class="toctree-l2"><a class="reference internal" href="templates.html#jinja">Jinja 快速入门</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html#id3">如何组织模板</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html#id4">继承</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html#id6">创建宏</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html#id9">自定义过滤器</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html#id11">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="static.html">静态文件</a><ul>
<li class="toctree-l2"><a class="reference internal" href="static.html#id2">组织你的静态文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="static.html#flask-assets">使用 Flask-Assets 管理静态资源</a></li>
<li class="toctree-l2"><a class="reference internal" href="static.html#id7">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="storing.html">存储数据</a><ul>
<li class="toctree-l2"><a class="reference internal" href="storing.html#sqlalchemy">SQLAlchemy</a></li>
<li class="toctree-l2"><a class="reference internal" href="storing.html#id5">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="forms.html">处理表单</a><ul>
<li class="toctree-l2"><a class="reference internal" href="forms.html#flask-wtf">Flask-WTF</a></li>
<li class="toctree-l2"><a class="reference internal" href="forms.html#id9">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="users.html">处理用户的模式</a><ul>
<li class="toctree-l2"><a class="reference internal" href="users.html#id2">确认电子邮箱</a></li>
<li class="toctree-l2"><a class="reference internal" href="users.html#id3">存储密码</a></li>
<li class="toctree-l2"><a class="reference internal" href="users.html#id5">认证</a></li>
<li class="toctree-l2"><a class="reference internal" href="users.html#id7">忘记密码</a></li>
<li class="toctree-l2"><a class="reference internal" href="users.html#id8">摘要</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">部署</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">主机</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">部署方式</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">摘要</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conclusion.html">结尾</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Explore Flask</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>部署</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/deployment.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="id1">
<h1>部署<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<img alt="Deployment" src="_images/deployment.png" />
<p>我们终于准备好向全世界展示我们的应用程序了。是时候要部署。这个过程可能是痛苦的因为有许多琐碎的事情要去做。当涉及到生产环境的搭建以及服务器的配置方案，这是有很多的选择需要做出。在本章中，我们会讨论一些重要的部分以及一些我们可能会用到的选项（关于主机或者服务器的搭建方式等等）。</p>
<div class="section" id="id2">
<h2>主机<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>首先我们需要一台服务器。现在有成千上万的服务器供应商，但是我个人建议的有三家。我不打算在这里介绍如何开始使用它们的细节，因为这是超出了本书的范围。相反我会讨论在它们上托管 Flask 应用程序的好处。</p>
<div class="section" id="ec2">
<h3>亚马逊网络服务 EC2<a class="headerlink" href="#ec2" title="Permalink to this headline">¶</a></h3>
<p>亚马逊网络服务是一个由亚马逊提供的服务的集合。有可能在之前你已经听说过它们可能成为新的创业者这些天的一个流行的选择。在亚马逊网络服务（AWS）中，我们最关心的是亚马逊弹性计算云（EC2）。亚马逊弹性计算云（EC2）最大的卖点就是我们得到一个虚拟服务器 - 或者用亚马逊网络服务（AWS）的说法叫做 <strong>实例</strong> - 几秒就能运行起来。如果我们迅速扩展我们的应用程序，只需要为我们的应用程序启动几个亚马逊弹性计算云（EC2）的实例并且把它们置于一个负载匀衡器之后（甚至我们能使用亚马逊网络服务（AWS）弹性负载均衡）。</p>
<p>至于 Flask，亚马逊网络服务（AWS）只是一个普通的虚拟服务器。我们可以在其上安装一个 linux 发行版并且安装我们的 Flask 应用程序以及我们服务器套件，无需太多的开销。这就意味着我们只需要一定的系统管理知识。</p>
</div>
<div class="section" id="heroku">
<h3>Heroku<a class="headerlink" href="#heroku" title="Permalink to this headline">¶</a></h3>
<p>Heroku 是一个建立在亚马逊网络服务（AWS）之上的应用程序托管服务，像亚马逊弹性计算云（EC2）一样。它们让我们充分利用亚马逊弹性计算云（EC2）的便利性而且不需要系统管理的经验。</p>
<p>在 Heroku 中，我们使用 <tt class="docutils literal"><span class="pre">git</span> <span class="pre">push</span></tt> 部署我们的应用程序到它们的服务器上。这真的是很便利，我们不需要花费我们的时间在 SSHing 到一个服务器上，安装以及配置软件并且想出一个合理的部署过程。</p>
<p>这种便利性带来的就是价格问题，尽管亚马逊网络服务（AWS）和 Heroku 提供了一定的免费服务。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Heroku 有一个使用它们的服务 <a class="reference external" href="https://devcenter.heroku.com/articles/getting-started-with-python">部署 Flask 的教程</a>。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>管理你自己的数据库是非常耗时并且做起来需要一定的经验。通过亲自为自己的项目管理数据库是一种好的学习方式，但是有时候你想要通过委托外部专业人士来节省时间。</p>
<p>无论是 Heroku 还是亚马逊网络服务（AWS）都有数据库管理的产品。我个人还没有亲自使用过它们，但是我听说它们还不赖。如果你要确保你的数据被保护和备份并且无需自己做事情的话，它们值得考虑。</p>
<ul class="last simple">
<li><a class="reference external" href="https://www.heroku.com/postgres">Heroku Postgres</a></li>
<li><a class="reference external" href="https://aws.amazon.com/rds/">Amazon RDS</a></li>
</ul>
</div>
</div>
<div class="section" id="digital-ocean">
<h3>Digital Ocean<a class="headerlink" href="#digital-ocean" title="Permalink to this headline">¶</a></h3>
<p>Digital Ocean 是亚马逊弹性计算云（EC2）的一个竞争对手，最近开始飞速地发展。像亚马逊弹性计算云（EC2）一样，Digital Ocean 让我们很快地启动一个虚拟服务器 - 现在称为 <strong>droplets</strong> 。所有的 droplets 是在固态硬盘（SSDs）上运行。对于我来说最大的卖点就是一个接口，这个接口比起亚马逊网络服务（AWS）控制面板更加简单和更加容易使用。Digital Ocean 是我偏爱的主机提供商，我建议你们可以看看它。</p>
<p>Digital Ocean 上部署 Flask 的过程与在亚马逊弹性计算云（EC2）上几乎一样。我们可以在其上安装一个 linux 发行版并且安装我们的 Flask 应用程序以及我们服务器套件。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Digital Ocean 为 Kickstarter 针对 <em>探索 Flask</em> 的活动做出足够大的贡献。就像我前面推荐使用 Digital Ocean，我保证我的建议是来自作为 Digital Ocean 用户的亲自经历。如果我不喜欢它的话，我也不会推荐它作为首选。</p>
</div>
</div>
</div>
<div class="section" id="id3">
<h2>部署方式<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>本节将介绍一些软件，我们需要安装这些软件在我们的服务器用来服务我们的 Flask 应用程序展示给全世界。最基本的部署方式就是有一个前置服务器，该服务器反向代理请求到运行我们 Flask 应用程序的应用运行器。我们通常也会有一个数据库，因此我们同样多多少少会讨论到这些方式。</p>
<div class="section" id="id4">
<h3>应用程序运行器<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>当我们开发我们的应用程序的时候，我们用来本地运行 Flask 的服务器不擅长处理真实的请求。当我们实际上需要把我们的应用程序面向公众的话，我们要使用一个应用程序运行器来运行它，像 Gunicorn 一样。Gunicorn 可以像线程一样处理请求和处理一些复杂的事情。</p>
<p>要使用 Gunicorn，我们要用 Pip 在我们的虚拟环境中安装 <tt class="docutils literal"><span class="pre">gunicorn</span></tt> 包。运行我们的应用程序是一个简单的命令行。</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># app.py</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">&quot;Hello World!&quot;</span>
</pre></div>
</td></tr></table></div>
<p>一个简单的应用程序已经完成。现在，为了用 Gunicorn 来服务于它，我们简单地运行 <tt class="docutils literal"><span class="pre">gunicorn</span></tt> 命令行。</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre>(ourapp)$ gunicorn rocket:app
2014-03-19 16:28:54 [62924] [INFO] Starting gunicorn 18.0
2014-03-19 16:28:54 [62924] [INFO] Listening at: http://127.0.0.1:8000 (62924)
2014-03-19 16:28:54 [62924] [INFO] Using worker: sync
2014-03-19 16:28:54 [62927] [INFO] Booting worker with pid: 62927
</pre></div>
</td></tr></table></div>
<p>这时候，当我们的浏览器访问 <em>http://127.0.0.1:8000</em> 的时候，我们应该看到 &#8220;Hello World!&#8221;。</p>
<p>为了在后台运行这个服务器（即：作为一个守护进程），我们可以给 Gunicorn 传入 <tt class="docutils literal"><span class="pre">-D</span></tt> 参数。在这种方式下，即使我们关闭当前的终端会话，它依然运行。</p>
<p>如果我们把 Gunicorn 作为一个守护进程的话，我们可能会很难找到进程当后面我们要停止服务器的时候。我们能够告诉 Gunicorn 把进程 ID 放入到一个文件中以便后面我们能够停止或者重启它，而无需搜索整个运行进行的列表。我们使用 <tt class="docutils literal"><span class="pre">-p</span> <span class="pre">&lt;file&gt;</span></tt> 选项来做到这一点。</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre>(ourapp)$ gunicorn rocket:app -p rocket.pid -D
(ourapp)$ cat rocket.pid
63101
</pre></div>
</td></tr></table></div>
<p>要重启以及杀死服务器，我们可以分别运行 <tt class="docutils literal"><span class="pre">kill</span> <span class="pre">-HUP</span></tt> 和 <tt class="docutils literal"><span class="pre">kill</span></tt>。</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre>(ourapp)$ kill -HUP `cat rocket.pid`
(ourapp)$ kill `cat rocket.pid`
</pre></div>
</td></tr></table></div>
<p>默认情况下，Gunicorn 运行在端口 8000。我们可以通过添加 <tt class="docutils literal"><span class="pre">-b</span></tt> 绑定选项来更改端口。</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>(ourapp)$ gunicorn rocket:app -p rocket.pid -b 127.0.0.1:7999 -D
</pre></div>
</td></tr></table></div>
<div class="section" id="gunicorn">
<h4>让 Gunicorn 对外开放<a class="headerlink" href="#gunicorn" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Gunicorn 是要在一个反向代理的后面。如果你要让它接受来自外部公众的请求，它很容易地遭受拒绝服务攻击。它很难处理这些类型的请求。因此仅仅允许外部的连接为调试的目的并且确保在实际运行中切回到只允许内部连接。</p>
</div>
<p>如果我们像上面介绍的运行 Gunicorn 的话，我们无法接受到外部的请求，只能接收到本机的请求。这是因为 Gunicorn 默认是绑定到 127.0.0.1。这就意味着它仅仅监听来自服务器本机的连接。这就是我们希望的运行方式，我们会有一个反向代理的服务器，它位于外部于我们的 Gunicorn 服务器之间。然而，如果我们需要为了调试目的接受来自外部的请求，我们可以要求 Gunicorn 绑定到 0.0.0.0。这就是告诉它监听所有的请求。</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>(ourapp)$ gunicorn rocket:app -p rocket.pid -b 0.0.0.0:8000 -D
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference external" href="http://docs.gunicorn.org/en/latest/">在官方文档</a> 中阅读更多关于运行以及部署 Gunicorn 更多的内容。</li>
<li><a class="reference external" href="http://docs.fabfile.org/en/latest">Fabric</a> 是一个工具，它让你舒适地在本机运行所有这些部署以及管理命令行，无需 SSHing 到每一台服务器。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="nginx">
<h3>Nginx 反向代理<a class="headerlink" href="#nginx" title="Permalink to this headline">¶</a></h3>
<p>一个反向代理处理公开的 HTTP 请求，发送它们到 Gunicorn 并且给出响应回到请求的客户端。Nginx 可以很有效地用于一个反向代理并且 Gunicorn “强烈建议” 我们使用 Nginx。</p>
<p>为了配置 Nginx 作为运行在 127.0.0.1:8000 上的 Gunicorn 服务器的一个反向代理，我们可以为我们的应用程序创建一个文件：
<em>/etc/nginx/sites-available/expl-oreflask.com</em>。</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre># /etc/nginx/sites-available/exploreflask.com

# Redirect www.exploreflask.com to exploreflask.com
server {
        server_name www.exploreflask.com;
        rewrite ^ http://exploreflask.com/ permanent;
}

# Handle requests to exploreflask.com on port 80
server {
        listen 80;
        server_name exploreflask.com;

                # Handle all locations
        location / {
                        # Pass the request to Gunicorn
                proxy_pass http://127.0.0.1:8000;

                # Set some HTTP headers so that our app knows where the
                # request really came from
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
}
</pre></div>
</td></tr></table></div>
<p>现在我们创建一个符号链接指向这个文件到 <em>/etc/nginx/sites-enabled</em> 上并且重启 Nginx。</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre>$ sudo ln -s \
/etc/nginx/sites-available/exploreflask.com \
/etc/nginx/sites-enabled/exploreflask.com
</pre></div>
</td></tr></table></div>
<p>我们现在应该可以让 Nginx 接收我们的请求并且接收来自我们的应用程序的响应。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">在 Gunicorn 文档中的 <a class="reference external" href="http://docs.gunicorn.org/en/latest/deploy.html#nginx-configuration">Nginx 配置部分</a> 会给你更多关于设置 Nginx 反向代理的信息。</p>
</div>
<div class="section" id="proxyfix">
<h4>ProxyFix<a class="headerlink" href="#proxyfix" title="Permalink to this headline">¶</a></h4>
<p>我们可能会碰到使用 Flask 不能处理代理请求的一些问题。这是与我们设置 Nginx 中配置的那些头有关。我们可以使用 Werkzeug 的 ProxyFix 来修复代理请求的问题。</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># app.py</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="c"># Import the fixer</span>
<span class="kn">from</span> <span class="nn">werkzeug.contrib.fixers</span> <span class="kn">import</span> <span class="n">ProxyFix</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c"># Use the fixer</span>
<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">ProxyFix</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">&quot;Hello World!&quot;</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>在 <a class="reference external" href="http://werkzeug.pocoo.org/docs/contrib/fixers/#werkzeug.contrib.fixers.ProxyFix">Werkzeug 官方文档</a> 中获取更多关于 ProxyFix 的信息。</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="id7">
<h2>摘要<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>托管 Flask 应用程序的三个好的选择是 AWS EC2，Heroku 以及 Digital Ocean。</li>
<li>对于一个 Flask 应用程序最合理的部署搭配就是一个应用程序运行器和一个像 Nginx 的反向代理。</li>
<li>Gunicorn 应该位于 Nginx 后面并且监听在 127.0.0.1（内部请求）而不是监听在 0.0.0.0（外部请求）。</li>
<li>在你的 Flask 应用程序中使用 Werkzeug 的 ProxyFix 来处理合适的代理头。</li>
</ul>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="conclusion.html" class="btn btn-neutral float-right" title="结尾"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="users.html" class="btn btn-neutral" title="处理用户的模式"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Robert Picard.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50579609-1', 'exploreflask.com');
  ga('send', 'pageview');

</script>


</body>
</html>